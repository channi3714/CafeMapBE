<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>감각적인 카페 지도 - Insta ver.</title>
    <style>
        /* 전역 스타일 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #fafafa; /* 인스타그램 배경색 */
            color: #262626; /* 인스타그램 텍스트 색상 */
            margin: 0;
            padding: 0;
        }

        /* 컨테이너 및 헤더 */
        .container {
            max-width: 935px; /* 인스타그램 피드 너비 */
            margin: 0 auto;
            padding: 20px 0;
        }

        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2em;
            font-weight: 300; /* 얇은 폰트 */
            margin: 0;
        }
        
        /* 메인 콘텐츠 영역 (지도와 목록) */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* 지도 스타일 */
        #map-container {
            background-color: #fff;
            border: 1px solid #dbdbdb;
            border-radius: 3px;
            overflow: hidden;
        }
        
        #map {
            width: 100%;
            height: 500px;
        }
        
        /* 카페 목록 스타일 */
        #cafe-list-container {
            padding: 10px;
        }

        h2 {
            font-size: 1.2em;
            font-weight: 600;
            color: #8e8e8e;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        #cafe-data-ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 28px;
            grid-template-columns: repeat(2, 1fr); /* 2열 그리드 */
        }
        
        /* 카페 아이템 카드 스타일 */
        .cafe-item {
            background-color: #fff;
            border: 1px solid #dbdbdb;
            border-radius: 3px;
            padding: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
        }
        
        .cafe-item::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            border: 2px solid transparent;
            border-radius: 3px;
            transition: border-color 0.2s ease;
        }
        
        .cafe-item:hover::before {
            border-color: #8e8e8e;
        }
        
        .cafe-item strong {
            font-size: 1.1em;
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }
        
        .cafe-item p {
            margin: 0;
            color: #8e8e8e;
            font-size: 0.9em;
        }

        /* 로딩 및 오류 메시지 스타일 */
        #cafe-data-ul li {
            text-align: center;
            font-size: 0.9em;
            color: #8e8e8e;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>CAFE MAP</h1>
    </header>

    <div class="main-content">
        <div id="map-container">
            <div id="map"></div>
        </div>
    
        <div id="cafe-list-container">
            <h2>LOCATIONS</h2>
            <ul id="cafe-data-ul">
                <li>데이터를 불러오는 중...</li>
            </ul>
        </div>
    </div>
</div>

<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=36b2fdb2239760e19810f7ef8e19aa9a"></script>

<script>
    var mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(35.8459, 128.6277),
            level: 7
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var cafeDataUl = document.getElementById('cafe-data-ul');
    cafeDataUl.innerHTML = '';

    fetch('/api/cafes/')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.length === 0) {
                cafeDataUl.innerHTML = '<li>데이터가 없습니다. (API 호출 실패 또는 결과 없음)</li>';
                return;
            }

            data.forEach(cafe => {
                var listItem = document.createElement('li');
                listItem.className = 'cafe-item';
                listItem.innerHTML = `
                    <strong>${cafe.업소명 || '이름 없음'}</strong>
                    <p>도로명 주소: ${cafe['소재지(도로명)'] || '주소 없음'}</p>
                    <p>위도: ${cafe.위도 || '없음'}, 경도: ${cafe.경도 || '없음'}</p>
                `;
                cafeDataUl.appendChild(listItem);

                if (cafe.위도 && cafe.경도) {
                    var markerPosition = new kakao.maps.LatLng(cafe.위도, cafe.경도);
                    var marker = new kakao.maps.Marker({
                        position: markerPosition
                    });
                    marker.setMap(map);

                    var infoWindow = new kakao.maps.InfoWindow({
                        content: `<div style="padding:5px;font-size:12px;">${cafe.업소명}</div>`
                    });

                    kakao.maps.event.addListener(marker, 'mouseover', function() {
                        infoWindow.open(map, marker);
                    });

                    kakao.maps.event.addListener(marker, 'mouseout', function() {
                        infoWindow.close();
                    });
                }
            });
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            cafeDataUl.innerHTML = `<li>데이터를 불러오는 중 오류 발생: ${error.message}</li>`;
        });
</script>
</body>
</html>